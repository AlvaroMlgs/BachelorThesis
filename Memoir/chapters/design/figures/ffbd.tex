
\begin{figure}[htbp]
\centering
	\begin{tikzpicture}
		
		\tikzstyle{reference}=[ellipse,
			fill=black!30,draw=black,thin,
			minimum height=0.7cm,minimum width=2cm,inner sep=1mm,
			align=center,node distance=3.5cm]
		\tikzstyle{function}=[rectangle,rounded corners,
			fill=teal!40,draw=black,semithick,
			minimum height=0.7cm,minimum width=2cm,inner sep=2mm,
			align=center,node distance=3cm]
		\tikzstyle{logic}=[circle,
			fill=teal!70!black!70,text=white,
			inner sep=1mm,node distance=2cm]
		\tikzstyle{boundary}=[rounded corners,
			draw=red!70!black!100,very thick,dashed]
		\tikzstyle{arrow}=[>=stealth,->,thick]


		\node[function]	(prelaunch)	{1.0/ Pre-launch\\ stage};
		\node[function,right of=prelaunch]	(start-mission)	{2.0/ Start\\ mission};
		\node[logic,right of=start-mission]	(start-and)	{and};
		\node[function,above right of=start-and]	(detect)	{3.0/ Detect\\ obstacle};
		\node[function,right of=detect]	(avoid)	{4.0/ Avoid\\ collision};
		\node[function,right of=start-and,xshift=2cm]	(UAV)	{5.0/ Communicate\\ with UAV};
		\node[function,below right of=start-and]	(GCS)	{6.0/ Communicate\\ with GCS};
		\node[function,right of=UAV,xshift=1.5cm]	(end-mission)	{7.0/ Terminate\\ mission};
		\coordinate[left of=end-mission,node distance=2cm] (end-node) {};

		\draw[arrow] (prelaunch) -- (start-mission);
		\draw[arrow] (start-mission) -- (start-and);
		\draw[arrow] (start-and) |- (detect);
		\draw[arrow] (start-and) -- (UAV);
		\draw[arrow] (start-and) |- (GCS);
		\draw[arrow] (detect) -- (avoid);
		\draw[arrow] (avoid) -| (end-node) -- (end-mission);
		\draw[arrow] (UAV) -- (end-mission);
		\draw[arrow] (GCS) -| (end-node) -- (end-mission);
		\draw[arrow,dashed] (detect) -- (GCS);
		\draw[arrow,dashed] (UAV) -- (avoid);

		\draw[boundary] ($(prelaunch)+(-1.8cm,-1cm)$) -- ($(prelaunch)+(-1.8cm,1cm)$)
			-- ($(prelaunch)+(1.8cm,1cm)$) -- ($(prelaunch)+(1.8cm,-0.8cm)$)
			-- ($(start-and)+(-0.7cm,-0.8cm)$) -- ($(start-and)+(-0.7cm,3cm)$)
			-- ($(end-node)+(0.3cm,3cm)$) -- ($(end-node)+(0.3cm,-3cm)$)
			-- ($(start-and)+(-0.7cm,-3cm)$) -- ($(start-and)+(-0.7cm,-1cm)$) 
			-- cycle;
		
	\end{tikzpicture}

	\caption{OCAS Functional Flow Block Diagram. TOP LEVEL}
	\label{fig:ffbd0}

\end{figure}


\begin{figure}[htbp]
\centering
	\begin{tikzpicture}
		
		\tikzstyle{reference}=[rectangle,rounded corners=0.5cm,
			fill=black!30,draw=black,thin,
			minimum height=0.7cm,minimum width=2cm,inner sep=2mm,
			align=center,node distance=3.5cm]
		\tikzstyle{function}=[rectangle,rounded corners,
			fill=teal!40,draw=black,semithick,
			minimum height=0.7cm,minimum width=2cm,inner sep=2mm,
			align=center,node distance=3.5cm]
		\tikzstyle{logic}=[circle,
			fill=teal!70!black!70,text=white,
			inner sep=1mm,node distance=2cm]
		\tikzstyle{boundary}=[rounded corners,
			draw=red!70!black!100,very thick,dashed]
		\tikzstyle{arrow}=[>=stealth,->,thick]

		\node[reference]	(pilot)	{Ref./\\ Pilot input};
		\node[function,right of=pilot]	(GCS)	{1.1/ Start\\ data-link\\ with GCS};
		\node[function,right of=GCS]	(OCAS)	{1.2/ Start\\ OCAS};
		\node[function,right of=OCAS]	(UAV)	{1.3/ Start\\ data-link\\ with UAV};
		\node[reference,right of=UAV]	(start)	{Ref. 2.0/\\ Start mission};

		\draw[arrow] (pilot) -- (GCS);
		\draw[arrow] (GCS) -- (OCAS);
		\draw[arrow] (OCAS) -- (UAV);
		\draw[arrow] (UAV) -- (start);

		\draw[boundary]	($(GCS)+(-1.5cm,-1.2cm)$) -- ($(GCS)+(-1.5cm,1.2cm)$)
			-- ($(UAV)+(1.5cm,1.2cm)$) -- ($(UAV)+(1.5cm,-1.2cm)$)
			-- cycle;
		
	\end{tikzpicture}

	\caption{OCAS Functional Flow Block Diagram. 1$^{\text{st}}$ STAGE}
	\label{fig:ffbd1}

\end{figure}


\begin{figure}[htbp]
\centering
	\begin{tikzpicture}
		
		\tikzstyle{reference}=[rectangle,rounded corners=0.5cm,
			fill=black!30,draw=black,thin,
			minimum height=0.7cm,minimum width=2cm,inner sep=2mm,
			align=center,node distance=3.5cm]
		\tikzstyle{function}=[rectangle,rounded corners,
			fill=teal!40,draw=black,semithick,
			minimum height=0.7cm,minimum width=2cm,inner sep=2mm,
			align=center,node distance=3cm]
		\tikzstyle{logic}=[circle,
			fill=teal!70!black!70,text=white,
			inner sep=1mm,node distance=2.3cm]
		\tikzstyle{boundary}=[rounded corners,
			draw=red!70!black!100,very thick,dashed]
		\tikzstyle{arrow}=[>=stealth,->,thick]

		\node[reference]	(start)	{Ref. 2.0/\\ Start mission};
		\node[function,below of=start]	(monitor)	{3.1/ Monitor\\ environment};
		\node[reference,below of=monitor]	(GCS)	{Ref. 6.0/\\ Communicate\\ with GCS};
		\node[function,right of=monitor]	(detect)	{3.2/ Confirm\\ detection};
		\node[logic,right of=detect]	(and)	{and};
		\node[function,above right of=and,yshift=-1cm]	(distance)	{3.3/ Evaluate\\ distance};
		\node[function,below right of=and,yshift=1cm]	(velocity)	{3.4/ Evaluate\\ velocity};
		\coordinate[right of=and,xshift=3cm] (coord) {};
		\node[function,right of=coord,xshift=-1.2cm]	(threat)	{3.5/ Evaluate\\ level of threat};
		\node[function,right of=threat]	(decide)	{3.6/ Decide\\ on action};
		\node[reference,below of=decide]	(avoid)	{Ref. 4.0/\\ Avoid collision};

		\draw[arrow] (start) -- (monitor);
		\draw[arrow] (monitor) -- (detect);
		\draw[arrow] (detect) -- (and);
		\draw[arrow] (and) |- (distance);
		\draw[arrow] (and) |- (velocity);
		\draw[arrow] (distance) -| (coord) -- (threat);
		\draw[arrow] (velocity) -| (coord) -- (threat);
		\draw[arrow] (threat) -- (decide);
		\draw[arrow] (decide) -- node[right]{Dangerous}(avoid);
		\draw[arrow] (decide) -- node[right,align=left]{Not\\ dangerous} ($(decide)+(0,1.9cm)$) 
			-- ($(monitor)+(0.3cm,1.9cm)$) -- ($(monitor)+(0.3cm,0.582cm)$);
		\draw[arrow,dashed] (monitor) -- (GCS);

		\draw[boundary] ($(monitor)+(-1.7cm,2.2cm)$) rectangle ($(decide)+(2.2cm,-2.2cm)$);
		
	\end{tikzpicture}

	\caption{OCAS Functional Flow Block Diagram. 2$^{\text{nd}}$ STAGE}
	\label{fig:ffbd2}

\end{figure}
